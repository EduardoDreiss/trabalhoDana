{% extends 'base.html' %} {% block title %}Cat√°logo | Todas as M√∫sicas
Spotify{%endblock %} {% block content %} {{
dados_para_js|json_script:"spotify-data" }}

<h1 style="color: #00b409">
  üìö Cat√°logo de M√∫sicas (Dataset Spotify)
  <hr style="border-color: #282828" />
</h1>
<p>
  Visualize, ordene e utilize os <strong>IDs</strong> das m√∫sicas para as
  simula√ß√µes de busca. Total de registros:
  <strong id="totalRegistros">Carregando...</strong>
</p>

<style>
  body {
    background-color: #121212;
    color: #ffffff;
  }

  a {
    color: #00b409;
    text-decoration: none;
  }

  a:hover {
    color: #1ed760;
  }

  .container-main {
    display: flex;
    gap: 40px;
    margin-top: 30px;
  }

  strong {
    color: #00b409;
  }

  .column-left {
    flex: 0 0 350px;
  }

  .column-right {
    flex: 1;
  }

  .command-box {
    border: 1px solid #222222;
    border-radius: 8px;
    padding: 20px;
    margin-bottom: 20px;
    background-color: #1a1a1a;
    box-shadow: 0 4px 8px rgba(0, 0, 0, 0.3);
  }

  .list-window {
    height: 600px;
    overflow-y: auto;
    border: 1px solid #222222;
    border-radius: 8px;
    background-color: #1e1e1e;
    padding: 0;
    box-shadow: 0 4px 12px rgba(0, 0, 0, 0.5);
  }

  .list-window::-webkit-scrollbar {
    width: 8px;
    background-color: transparent;
  }

  .list-window::-webkit-scrollbar-thumb {
    background-color: #555;
    border-radius: 10px;
    border: 2px solid #1e1e1e;
  }

  .list-window::-webkit-scrollbar-thumb:hover {
    background-color: #777;
  }

  .list-window {
    scrollbar-width: thin;
    scrollbar-color: #555 #1e1e1e;
  }

  .song-table {
    width: 100%;
    border-collapse: collapse;
  }

  .song-table th {
    background-color: #282828;
    color: #b3b3b3;
    padding: 10px;
    text-align: left;
    position: sticky;
    top: 0;
    z-index: 10;
    cursor: pointer;
  }

  .song-table td {
    padding: 10px;
    border-bottom: 1px solid #333333;
    vertical-align: middle;
    font-size: 0.9em;
  }

  .song-table tr:hover {
    background-color: #2a2a2a;
  }

  .track-id-cell {
    font-family: monospace;
    color: #00b409;
    font-size: 0.8em;
    cursor: copy;
    transition: color 0.2s;
  }

  .track-id-cell:hover {
    color: #1ed760;
  }
  .filter-buttons {
    display: flex;
    flex-direction: column;
    gap: 10px;
  }

  .filter-buttons button {
    background-color: #00b409;
    color: black;
    border: none;
    padding: 10px 15px;
    margin: 0;
    border-radius: 5px;
    cursor: pointer;
    font-weight: bold;
    transition: background-color 0.3s;
    width: 100%;
    text-align: left;
  }

  .filter-buttons button:hover {
    background-color: #1ed760;
  }

  .filter-buttons button.active {
    background-color: #1ed760;
    border: 2px solid #00b409;
    box-shadow: 0 0 8px rgba(0, 180, 9, 0.7);
  }

  @media (max-width: 768px) {
    .container-main {
      flex-direction: column;
      gap: 20px;
      margin-top: 15px;
    }

    .column-left,
    .column-right {
      flex: 1 1 auto;
      min-width: 100%;
    }

    .list-window {
      height: auto;
      max-height: 500px;
      overflow-y: auto;
    }

    .song-table,
    .song-table tbody,
    .song-table tr,
    .song-table td {
      display: block;
    }

    .song-table th {
      position: static;
      display: table-cell;
    }

    .column-right .list-window {
      overflow-x: auto;
    }

    .song-table {
      min-width: 600px;
    }

    .song-table th,
    .song-table td {
      padding: 8px 5px;
      font-size: 0.85em;
    }

    .song-table th:last-child,
    .song-table td:last-child {
      width: 120px;
    }

    .track-id-cell {
      word-break: break-all;
    }
  }
</style>

<div class="container-main">
  <div class="column-left">
    <div class="command-box">
      <h2>Op√ß√µes de Listagem:</h2>
      <div class="filter-buttons">
        <button id="original-btn" onclick="sortList('original_order', this)">
          Ordem Padr√£o (BD)
        </button>

        <button id="pop-desc-btn" onclick="sortList('popularidade_desc', this)">
          üî• Mais Populares
        </button>
        <button id="pop-asc-btn" onclick="sortList('popularidade_asc', this)">
          üßä Menos Populares
        </button>
        <button id="nome-asc-btn" onclick="sortList('nome_asc', this)">
          T√≠tulo (A-Z)
        </button>
      </div>
      <p style="margin-top: 20px; font-size: 0.9em; color: #b3b3b3">
        Clique no cabe√ßalho da coluna "Popularidade" para inverter rapidamente a
        ordena√ß√£o.
      </p>
    </div>
  </div>

  <div class="column-right">
    <h2>Lista de M√∫sicas:</h2>

    <div class="list-window">
      <table class="song-table">
        <thead>
          <tr>
            <th>Nome da M√∫sica</th>
            <th>Artista</th>
            <th id="popularidade-header">Popularidade</th>
            <th>ID da M√∫sica</th>
          </tr>
        </thead>
        <tbody id="music-list-body">
          <tr>
            <td colspan="4" style="text-align: center">Carregando dados...</td>
          </tr>
        </tbody>
      </table>
    </div>
  </div>
</div>

<script>
  let rawData = [];
  let currentSortOrder = "original_order";

  const scriptElement = document.getElementById("spotify-data");
  if (scriptElement && scriptElement.textContent.trim().length > 0) {
    try {
      rawData = JSON.parse(scriptElement.textContent);
    } catch (e) {
      console.error(
        "Erro fatal: N√£o foi poss√≠vel processar os dados do servidor.",
        e
      );
    }
  }

  document.addEventListener("DOMContentLoaded", () => {
    document.getElementById("totalRegistros").textContent = rawData.length;

    renderList(rawData, currentSortOrder);

    document.getElementById("original-btn").classList.add("active");

    document
      .getElementById("popularidade-header")
      .addEventListener("click", togglePopularitySort);
  });

  function renderList(musicArray, sortOrder) {
    const tbody = document.getElementById("music-list-body");
    let htmlContent = "";

    const sortedArray = [...musicArray];

    if (sortOrder !== "original_order") {
      sortedArray.sort((a, b) => {
        const popA = parseInt(a.track_popularity);
        const popB = parseInt(b.track_popularity);

        if (sortOrder === "popularidade_desc") {
          return popB - popA;
        } else if (sortOrder === "popularidade_asc") {
          return popA - popB;
        } else if (sortOrder === "nome_asc") {
          return a.track_name.localeCompare(b.track_name);
        }
        return 0;
      });
    }

    sortedArray.forEach((musica) => {
      htmlContent += `
                <tr>
                    <td>${musica.track_name}</td>
                    <td>${musica.track_artist}</td>
                    <td>${musica.track_popularity}</td>
                    <td class="track-id-cell" title="Clique para copiar o ID: ${musica.track_id}" onclick="copyToClipboard('${musica.track_id}')">${musica.track_id}</td>
                </tr>
            `;
    });

    tbody.innerHTML = htmlContent;

    const header = document.getElementById("popularidade-header");

    if (sortOrder.startsWith("popularidade")) {
      header.innerHTML = `Popularidade (${
        sortOrder === "popularidade_desc" ? "‚Üì" : "‚Üë"
      })`;
    } else {
      header.innerHTML = `Popularidade`;
    }
  }

  function togglePopularitySort() {
    let targetButton;

    if (currentSortOrder === "popularidade_desc") {
      currentSortOrder = "popularidade_asc";
      targetButton = document.getElementById("pop-asc-btn");
    } else {
      currentSortOrder = "popularidade_desc";
      targetButton = document.getElementById("pop-desc-btn");
    }
    renderList(rawData, currentSortOrder);
    setActiveButton(targetButton);
  }

  function sortList(criteria, buttonElement) {
    currentSortOrder = criteria;
    renderList(rawData, currentSortOrder);
    setActiveButton(buttonElement);
  }

  function setActiveButton(activeButton) {
    const buttons = document.querySelectorAll(".filter-buttons button");
    buttons.forEach((btn) => btn.classList.remove("active"));
    if (activeButton) {
      activeButton.classList.add("active");
    }
  }

  function copyToClipboard(text) {
    navigator.clipboard.writeText(text).then(
      () => {
        alert("ID copiado para a √°rea de transfer√™ncia: " + text);
      },
      (err) => {
        console.error("Erro ao copiar: ", err);
        prompt("Copie manualmente o ID:", text);
      }
    );
  }
</script>

{% endblock content %}
